!function(e){if('serviceWorker'in navigator&&window.location.protocol=='https:'){window.addEventListener('load',function(){navigator.serviceWorker.register('./sw.js')})};function t(t){for(var n,i,o=t[0],c=t[1],u=t[2],d=0,h=[];d<o.length;d++)i=o[d],Object.prototype.hasOwnProperty.call(a,i)&&a[i]&&h.push(a[i][0]),a[i]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);for(l&&l(t);h.length;)h.shift()();return s.push.apply(s,u||[]),r()}function r(){for(var e,t=0;t<s.length;t++){for(var r=s[t],n=!0,o=1;o<r.length;o++){var c=r[o];0!==a[c]&&(n=!1)}n&&(s.splice(t--,1),e=i(i.s=r[0]))}return e}var n={},a={app:0},s=[];function i(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=n,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(r,n,function(t){return e[t]}.bind(null,n));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var o=window.webpackJsonp=window.webpackJsonp||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var u=0;u<o.length;u++)t(o[u]);var l=c;s.push([0,"chunk-vendors"]),r()}({0:function(e,t,r){e.exports=r("56d7")},"034f":function(e,t,r){"use strict";r("85ec")},"0661":function(e,t,r){"use strict";r("9559")},1:function(e,t){},"1c76":function(e,t,r){"use strict";r("f535")},2:function(e,t){},3:function(e,t){},"3f2d":function(e,t,r){"use strict";r("ef9e")},4:function(e,t){},"4f9f":function(e,t,r){},5:function(e,t){},"56d7":function(e,t,r){"use strict";r.r(t);var n=r("5530"),a=(r("e260"),r("e6cf"),r("cca6"),r("a79d"),r("2b0e")),s=(r("ac1f"),r("5319"),r("99af"),r("13d5"),r("4ec9"),r("b64b"),r("d3b7"),r("07ac"),r("3ca3"),r("ddb0"),r("2909")),i=r("b85c"),o=(r("96cf"),r("1da1")),c=(r("7db0"),r("8a79"),r("466d"),r("2ca0"),r("c4e3")),u=r.n(c),l=r("d4ec"),d=r("bee2"),h=function(){function e(t){Object(l.a)(this,e),this.src=t,this.filenames=Object.keys(this.src.files)}var t;return Object(d.a)(e,[{key:"getFileNames",value:function(){return this.filenames}},{key:"getFileContent",value:(t=Object(o.a)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new TextDecoder("windows-1251"),e.t0=r,e.next=4,this.src.file(t).async("uint8array");case 4:return e.t1=e.sent,e.abrupt("return",e.t0.decode.call(e.t0,e.t1));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}(),f=(r("a630"),r("d81d"),r("5cc6"),r("9a8c"),r("a975"),r("735e"),r("c1ac"),r("d139"),r("3a7b"),r("d5d6"),r("82f8"),r("e91f"),r("60bd"),r("5f96"),r("3280"),r("3fcc"),r("ca91"),r("25a1"),r("cd26"),r("3c5d"),r("2954"),r("649e"),r("219c"),r("170b"),r("b39a"),r("72f7"),function(){function e(t){Object(l.a)(this,e),this.src=t,this.filenames=Array.from(this.src.files).map((function(e){return e.webkitRelativePath}))}var t;return Object(d.a)(e,[{key:"getFileNames",value:function(){return this.filenames}},{key:"getFileContent",value:(t=Object(o.a)(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var n=new FileReader,a=Array.from(r.src.files).find((function(e){return e.webkitRelativePath==t}));n.onload=function(){var t=new Uint8Array(n.result),r=new TextDecoder("windows-1251");e(r.decode(t))},n.readAsArrayBuffer(a)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})}]),e}()),p=function(){function e(){Object(l.a)(this,e)}return Object(d.a)(e,[{key:"parse",value:function(e){e=(new DOMParser).parseFromString(e,"text/html").getElementsByClassName("item");var t={},r=Object(i.a)(e);try{for(r.s();!(n=r.n()).done;){var n=n.value.getElementsByTagName("a")[0];t[n.getAttribute("href").match(/([0-9-]+)+\//)[1]]=n.innerText}}catch(e){r.e(e)}finally{r.f()}return t}}]),e}(),m={loadZip:function(e){return Object(o.a)(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.loadAsync(e);case 2:return r=t.sent,t.next=5,m.contentLoaded(new h(r));case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))()},loadFolder:function(e){return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,m.contentLoaded(new f(e));case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)})))()},msgFileStructureFormer:function(e){var t=e.find((function(e){return e.endsWith("index-messages.html")}));if(!t)throw new EvalError("Index file not found");var r="index-messages.html"==t?"":t.match(/(.+)index-messages.html/)[1],n={},a=Object(i.a)(e);try{for(a.s();!(s=a.n()).done;){var s=s.value;!s.startsWith(r)||(s=s.match(/([0-9-]+)\/messages([0-9]+)/))&&(n[s[1]]?n[s[1]].push(parseInt(s[2])):n[s[1]]=[parseInt(s[2])])}}catch(e){a.e(e)}finally{a.f()}return{chatFiles:n,index:t,indexDir:r}},contentLoaded:function(e){return Object(o.a)(regeneratorRuntime.mark((function t(){var r,n,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=m.msgFileStructureFormer(e.getFileNames()),r=n.chatFiles,a=n.index,n=n.indexDir,t.t0=new p,t.next=4,e.getFileContent(a);case 4:return t.t1=t.sent,a=t.t0.parse.call(t.t0,t.t1),t.abrupt("return",{chats:a,chatFiles:r,indexDir:n,contentAdapterInstance:e});case 7:case"end":return t.stop()}}),t)})))()}},v=m,g=(r("2b3d"),{downloadBlob:function(e,t,r){r=new Blob([e],{type:r});var n=window.URL.createObjectURL(r);g.downloadURL(n,t),setTimeout((function(){return window.URL.revokeObjectURL(n)}),1e3)},downloadURL:function(e,t){var r=document.createElement("a");r.href=e,r.download=t,r.style="display: none",document.body.appendChild(r),r.click(),r.remove()}}),b=g,w=(r("c975"),r("1276"),r("ade3")),S="янв|фев|мар|апр|мая|июн|июл|авг|сен|окт|ноя|дек".split("|"),y=function(){function e(){Object(l.a)(this,e),Object(w.a)(this,"fallbackMsgID",1e9)}return Object(d.a)(e,[{key:"parse",value:function(e,t){e=(new DOMParser).parseFromString(e.replace(/<br>/g,"\n"),"text/html").getElementsByClassName("message");var r=[],n=new Map,a=Object(i.a)(e);try{for(a.s();!(c=a.n()).done;){var s=c.value,o=0<s.firstElementChild.getElementsByTagName("a").length?s.firstElementChild.getElementsByTagName("a")[0].getAttribute("href").match(/(public|club|id)([0-9-]+)/):0,c="Вы";o&&(o=(o[1].match(/public|club/)?-1:1)*parseInt(o[2]),c=s.firstElementChild.firstElementChild.innerText),n.set(o,c);var u={id:parseInt(s.getAttribute("data-id"))||this.fallbackMsgID--,cid:parseInt(t),from:o,date:this.parseDate(s.firstElementChild.textContent),txt:null!==(o=s.children[1].firstChild)&&void 0!==o&&o.innerText?"":1,att:[]};o=s.getElementsByClassName("attachment");if(0==o.length&&""==u.txt)try{u.txt=s.getElementsByClassName("kludges")[0].innerText}catch(e){u.txt=""}var l=Object(i.a)(o);try{for(l.s();!(d=l.n()).done;){var d=d.value;u.att.push(this.parseAttachment(d))}}catch(e){l.e(e)}finally{l.f()}1===u.txt&&(0<s.getElementsByClassName("kludges").length&&s.children[1].removeChild(s.children[1].lastChild),u.txt=s.children[1].innerText),r.push(u)}}catch(e){a.e(e)}finally{a.f()}return{messages:r,fromDB:n}}},{key:"parseDate",value:function(e){var t=e.match(/([0-9]{1,2}) (янв|фев|мар|апр|мая|июн|июл|авг|сен|окт|ноя|дек) ([0-9]{4}) в ([0-9]{1,2}):([0-9]{1,2}):([0-9]{1,2})/);e=new Date;return e.setYear(t[3]),e.setMonth(S.indexOf(t[2])),e.setDate(t[1]),e.setHours(t[4],t[5],t[6]),~~(e.getTime()/1e3)}},{key:"parseAttachment",value:function(e){var t=e.getElementsByClassName("attachment__link");return{desc:e.getElementsByClassName("attachment__description")[0].innerText,link:0<t.length?t[0].getAttribute("href"):void 0}}}]),e}(),k=r("fdac4"),_=r.n(k),E={idFilter:{all:function(e){return e},users:function(e){return 0<=e.id&&e.id<2e9},groups:function(e){return e.id<0&&-2e9<e.id},chats:function(e){return 2e9<=e.id}},SQLFilterFormer:function(e){var t,r="",n=0;for(t in e)if("_"!=t[0]){0!=n&&(r+=" AND "),r+="LIKE"in e[t]?"LOWER( ".concat(t," ) "):t+" ";var a,s=0;for(a in e[t])0!=s&&(r+=" AND "+t+" "),r+=a+" ",r+="LIKE"==a?e[t][a].toLowerCase():e[t][a],s++;n++}return"_order"in e&&(r+=" ORDER BY "+e._order,"_order_type"in e&&(r+=" "+e._order_type)),"_limit"in e&&(r+=" LIMIT "+e._limit),"_offset"in e&&(r+=" OFFSET "+e._offset),r}},x=function(){function e(){var t=this,r=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],n=1<arguments.length&&void 0!==arguments[1]&&arguments[1];Object(l.a)(this,e),this.db=!1,this.dbReady=new Promise((function(e,a){_()({locateFile:function(e){return"./"+e}}).then((function(s){var i;r?(i=new s.Database,(t.db=i).run("CREATE TABLE users (id INTEGER PRIMARY KEY, name TEXT)"),i.run("CREATE TABLE chats (id INTEGER PRIMARY KEY, name TEXT)"),i.run("CREATE TABLE messages (id INTEGER PRIMARY KEY, uid INTEGER, cid INTEGER, txt TEXT, att TEXT, date INTEGER, FOREIGN KEY (uid) REFERENCES users(id))")):t.db=new s.Database(n),t.db?e():a(0)}))}))}var t,r,n,a;return Object(d.a)(e,[{key:"addUser",value:function(e){this.db.run("INSERT INTO users (id, name) VALUES (".concat(e[0],", '").concat(this.q(e[1]),"')"))}},{key:"addMessage",value:(a=Object(o.a)(regeneratorRuntime.mark((function e(t){var r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r="INSERT INTO messages (id, uid, cid, txt, att, date)\n        VALUES (".concat(t.id,", ").concat(t.from,", ").concat(t.cid,", '").concat(this.q(t.txt),"', '").concat(0<t.att.length?this.q(JSON.stringify(t.att)):"","', ").concat(t.date,")"),this.db.run(r);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return a.apply(this,arguments)})},{key:"addChat",value:function(e,t){this.db.run("INSERT INTO chats (id, name) VALUES (".concat(e,", '").concat(this.q(t),"')"))}},{key:"normalize",value:function(e){var t,r=[],n=Object(i.a)(e.values);try{for(n.s();!(t=n.n()).done;){var a,s=t.value,o={};for(a in e.columns)o[e.columns[a]]=s[a];r.push(o)}}catch(e){n.e(e)}finally{n.f()}return r}},{key:"getChats",value:(n=Object(o.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var n=t.db.exec("SELECT * FROM chats")[0];n?e(t.normalize(n)):r(0)})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"getUsers",value:(r=Object(o.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){var n=t.db.exec("SELECT * FROM users")[0];n?e(t.normalize(n)):r(0)})));case 1:case"end":return e.stop()}}),e)}))),function(){return r.apply(this,arguments)})},{key:"getMessages",value:(t=Object(o.a)(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=E.SQLFilterFormer(t);a=r.db.exec("SELECT * FROM messages WHERE ".concat(a))[0];a?e(r.normalize(a).map((function(e){return e.att=e.att&&JSON.parse(e.att),e}))):n(0)})));case 1:case"end":return e.stop()}}),e)}))),function(e){return t.apply(this,arguments)})},{key:"q",value:function(e){return e.replace(/'/g,'"')}}]),e}(),R=function(){function e(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];Object(l.a)(this,e);var r=openDatabase("vkdb","1.0","Database with messages exported from VK",2097152,(function(e){"1.0"!=e.version&&(alert("Обнаружен баг Chrome, в котором версия базы WebSQL не совпадает с созданной. Это проблема устаняется обновлением страницы."),window.location.reload())}));t&&r.transaction((function(e){e.executeSql("DROP TABLE IF EXISTS users",[]),e.executeSql("DROP TABLE IF EXISTS messages",[]),e.executeSql("DROP TABLE IF EXISTS chats",[]),e.executeSql("CREATE TABLE users (id INTEGER PRIMARY KEY, name TEXT)"),e.executeSql("CREATE TABLE chats (id INTEGER PRIMARY KEY, name TEXT)"),e.executeSql("CREATE TABLE messages (id INTEGER PRIMARY KEY, uid INTEGER, cid INTEGER, txt TEXT, att TEXT, date INTEGER, FOREIGN KEY (uid) REFERENCES users(id))")})),this.db=r}var t,r,n,a,s;return Object(d.a)(e,[{key:"addUser",value:function(e){var t=this;this.db.transaction((function(r){r.executeSql("INSERT INTO users (id, name) VALUES (".concat(e[0],", '").concat(t.q(e[1]),"')"))}))}},{key:"addMessage",value:(s=Object(o.a)(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){r.db.transaction((function(n){var a="INSERT INTO messages (id, uid, cid, txt, att, date) VALUES (".concat(t.id,", ").concat(t.from,", ").concat(t.cid,", '").concat(r.q(t.txt),"', '").concat(0<t.att.length?r.q(JSON.stringify(t.att)):"","', ").concat(t.date,")");n.executeSql(a,[],e,(function(t,r){console.error(r),e()}))}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return s.apply(this,arguments)})},{key:"addChat",value:function(e,t){var r=this;this.db.transaction((function(n){n.executeSql("INSERT INTO chats (id, name) VALUES (".concat(e,", '").concat(r.q(t),"')"))}))}},{key:"getChats",value:(a=Object(o.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.db.transaction((function(t){t.executeSql("SELECT * FROM chats",[],(function(t,n){return e(Array.from(n.rows),(function(){return r(0)}))}))}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return a.apply(this,arguments)})},{key:"getUsers",value:(n=Object(o.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.db.transaction((function(t){t.executeSql("SELECT * FROM users",[],(function(t,n){return e(Array.from(n.rows),(function(){return r(0)}))}))}))})));case 1:case"end":return e.stop()}}),e)}))),function(){return n.apply(this,arguments)})},{key:"getMessages",value:(r=Object(o.a)(regeneratorRuntime.mark((function e(t){var r=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var a=E.SQLFilterFormer(t);r.db.transaction((function(t){t.executeSql("SELECT * FROM messages WHERE ".concat(a),[],(function(t,r){return e(Array.from(r.rows).map((function(e){return e.att=e.att&&JSON.parse(e.att),e})),(function(){return n(0)}))}))}))})));case 1:case"end":return e.stop()}}),e)}))),function(e){return r.apply(this,arguments)})},{key:"q",value:function(e){return e.replace(/'/g,'"')}},{key:"check",value:(t=Object(o.a)(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,r){t.db.transaction((function(t){t.executeSql("SELECT * FROM users LIMIT 1 OFFSET 0",[],(function(){return e(!0)}),(function(){return r(!1)}))}))})).catch((function(e){return e}))||!1);case 1:case"end":return e.stop()}}),e)}))),function(){return t.apply(this,arguments)})}]),e}(),O=(r("6062"),r("4dec")),C=function(){function e(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];Object(l.a)(this,e),t?O.a.delete("vkdb").then(this.init()):this.init()}var t,r,n,a,s;return Object(d.a)(e,[{key:"addUser",value:function(e){this.db.users.put({id:e[0],name:e[1]})}},{key:"addMessage",value:(s=Object(o.a)(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.messages.put({id:t.id,uid:t.from,cid:t.cid,txt:t.txt,att:t.att,date:t.date});case 2:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"addChat",value:function(e,t){this.db.chats.put({id:e,name:t})}},{key:"getChats",value:(a=Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.chats.toArray();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"getUsers",value:(n=Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.chats.toArray();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getMessages",value:(r=Object(o.a)(regeneratorRuntime.mark((function e(t){var r,n,a,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={"<":"bellow",">":"above","=":"equals",LIKE:"equals"},n=this.db.messages,!("cid"in t)||!("id"in t)){e.next=6;break}n=n.where("cid").equals(t.cid["="]).and((function(e){return"<"in t.id?e.id<t.id["<"]:e.id>t.id[">"]})),e.next=19;break;case 6:if(!("date"in t)){e.next=10;break}n=n.where("date").between(t.date[">"],t.date["<"]),e.next=19;break;case 10:e.t0=regeneratorRuntime.keys(t);case 11:if((e.t1=e.t0()).done){e.next=19;break}if("_"==(a=e.t1.value)[0])return e.abrupt("continue",11);e.next=15;break;case 15:for(s in n="LIKE"in t[a]?n.where("words"):n.where(a),t[a])"LIKE"==s&&(t[a][s]=t[a][s].replace(/[%']/g,"")),n=n[r[s]](t[a][s]);e.next=11;break;case 19:if("_offset"in t&&(n=n.offset(t._offset)),"_limit"in t&&(n=n.limit(t._limit)),!("_order"in t)){e.next=27;break}if("_order_type"in t)return"ASC"!=t._order_type&&(n=n.reverse()),e.next=26,n.sortBy(t._order);e.next=27;break;case 26:n=e.sent;case 27:return e.abrupt("return","toArray"in n?n.toArray():n);case 28:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"init",value:function(){this.db=new O.a("vkdb"),this.db.version(1).stores({users:"id, name",chats:"id, name",messages:"id, uid, cid, txt, att, date, *words"}),this.db.messages.hook("creating",(function(e,t){"string"==typeof t.txt&&(t.words=(t=t.txt,Array.from(new Set(t.replace(/[,.!?:"'()\n\r]/g,"").toLowerCase().split(" ")))))}))}},{key:"check",value:(t=Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.db.users.count();case 2:return e.t0=e.sent,e.abrupt("return",0!=e.t0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),T={name:"App",data:function(){return{activePanel:"storageSourceSelector",status:"загрузка метаданных",errorMsg:!1,progress:0,progress1:0,progress2:0,progress2text:"",importErrors:0,importErrorMsg:"",memory:0,storage:{quota:1/0,usage:0,percent:0},storageQuotaSupported:navigator.storage&&navigator.storage.estimate,memoryUseSupported:window.performance&&window.performance.memory,dbAdapters:{idb:C,wql:R,sql:x},dbProvider:!1,persisted:!1,radioValue:"wql"}},components:{},mixins:{FileOperationMixin:v},methods:{getStorageData:function(){var e=this;return Object(o.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.storageQuotaSupported)return t.next=3,navigator.storage.estimate();t.next=5;break;case 3:e.storage=t.sent,e.storage.percent=~~(e.storage.usage/e.storage.quota*100);case 5:case"end":return t.stop()}}),t)})))()},useRAMDB:function(){this.$root.db=this.dbProvider,this.$parent.selectView(2)},dbSelected:function(){var e=this;this.radioValue=document.querySelector("input[type=radio]:checked").value,this.dbProvider=new this.dbAdapters[this.radioValue](!0),"sql"!=this.radioValue&&navigator.storage&&navigator.storage.persist&&navigator.storage.persist().then((function(t){e.persisted=t})),this.getStorageData(),this.activePanel="importSourceSelector"},metaLoadingSuccess:function(e){this.startParsingMessages(e)},metaLoadingError:function(e){this.activePanel="importSourceSelector",this.errorMsg="Что-то пошло не так. Не удалось найти необходимые файлы. ("+e+")"},zipSelected:function(){var e=this,t=document.getElementById("zipselect");v.loadZip(t.files[0]).then((function(t){return e.metaLoadingSuccess(t)})).catch((function(t){return e.metaLoadingError(t)})),this.activePanel="loading"},dirSelected:function(){var e=this,t=document.getElementById("dirselect");v.loadFolder(t).then((function(t){return e.metaLoadingSuccess(t)})).catch((function(t){return e.metaLoadingError(t)})),this.activePanel="loading"},downloadDB:function(){b.downloadBlob(this.dbProvider.db.export(),"vk-msg.sqlite","application/octet-stream")},mainPage:function(){this.$emit("gohome")},startParsingMessages:function(e){var t=this;return Object(o.a)(regeneratorRuntime.mark((function r(){var n,a,o,c,u,l,d,h,f,p,m,v,g,b,w,S,k;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:b=Object.keys(e.chats),n=new y,a=b.length,c=o=0,u=Object.values(e.chatFiles).reduce((function(e,t){return e+t.length}),0),l=new Map,d=0,h=b;case 8:if(!(d<h.length)){r.next=59;break}f=h[d],o++,t.progress=~~(o/a*100),p=e.chatFiles[f].length,r.t0=regeneratorRuntime.keys(e.chatFiles[f]);case 14:if((r.t1=r.t0()).done){r.next=55;break}return m=r.t1.value,c++,0==m&&(t.progress2text="Импорт сообщений из диалога "+e.chats[f],t.getStorageData(),t.memory=t.memoryUseSupported?~~(window.performance.memory.usedJSHeapSize/window.performance.memory.jsHeapSizeLimit*100):0),r.prev=18,r.t2=n,r.next=22,e.contentAdapterInstance.getFileContent(e.indexDir+f+"/messages"+e.chatFiles[f][m]+".html");case 22:r.t3=r.sent,r.t4=f,v=r.t2.parse.call(r.t2,r.t3,r.t4),g=Object(i.a)(v.messages),r.prev=26,g.s();case 28:if((b=g.n()).done){r.next=35;break}return w=b.value,r.next=32,t.dbProvider.addMessage(w);case 32:w=void 0;case 33:r.next=28;break;case 35:r.next=40;break;case 37:r.prev=37,r.t5=r.catch(26),g.e(r.t5);case 40:return r.prev=40,g.f(),r.finish(40);case 43:l=new Map([].concat(Object(s.a)(l),Object(s.a)(v.fromDB))),t.progress1=~~(c/u*100),t.progress2=~~(m/p*100),r.next=53;break;case 48:r.prev=48,r.t6=r.catch(18),t.importErrors++,t.importErrorMsg=r.t6,console.error(r.t6);case 53:r.next=14;break;case 55:t.dbProvider.addChat(parseInt(f),e.chats[f]);case 56:d++,r.next=8;break;case 59:S=Object(i.a)(l.entries());try{for(S.s();!(k=S.n()).done;)k=k.value,t.dbProvider.addUser(k)}catch(r){S.e(r)}finally{S.f()}l=void 0,t.activePanel="finalstep",localStorage["vkmsg-db-sel"]=t.radioValue,"sql"==t.radioValue&&t.downloadDB();case 65:case"end":return r.stop()}}),r,null,[[18,48],[26,37,40,43]])})))()}}},P=(r("034f"),r("2877")),L=Object(P.a)(T,(function(){var e=this,t=e.$createElement;t=e._self._c||t;return t("div",{attrs:{id:"app"}},[t("VKView",{attrs:{activePanel:e.activePanel}},[t("Panel",{attrs:{id:"storageSourceSelector"}},[t("PanelHeader",[e._v("Импортировать сообщения в")]),t("Group",{attrs:{title:"Выберете, куда будут сохранены сообщения"}},[t("FormLayout",{staticClass:"leftform"},[t("Div",[t("Radio",{attrs:{name:"radio",value:"idb"}},[e._v("IndexedDB (этот браузер) медленно, просмотр + поиск по слову или дате")]),t("Radio",{attrs:{default:"",modelValue:"wql",name:"radio",value:"wql"}},[e._v("WebSQL (этот браузер) очень медленно, просмотр + полноценный поиск, только для браузеров на основе Chromium")]),t("Radio",{attrs:{name:"radio",value:"sql"}},[e._v("SQLite (файл) быстро, просмотр + полноценный поиск, потребляет много оперативной памяти")])],1),t("Div",[t("Button",{attrs:{level:"outline"},on:{click:e.dbSelected}},[e._v("Далее")])],1)],1)],1)],1),t("Panel",{attrs:{id:"importSourceSelector"}},[t("PanelHeader",[e._v("Импорт из архива ВК")]),t("br"),t("Group",[t("Div",[t("label",{attrs:{for:"zipselect"}},[t("Button",[e._v("Импортировать из zip-папки с директорией messages")])],1)]),t("Div",[t("label",{attrs:{for:"dirselect"}},[t("Button",[e._v("Импортировать директорию messages")])],1)]),e.errorMsg?t("CellButton",{attrs:{level:"danger"}},[e._v(e._s(e.errorMsg))]):e._e()],1),e.storageQuotaSupported&&e.storage.quota<4e8&&!e.persisted&&"sql"!=e.radioValue?t("Div",[e._v(" Доступного места в хранилище браузера может не хватить для крупного архива сообщений. Сейчас сайту доступно "+e._s(~~(e.storage.quota/1e6))+" МБ. Освободите память, или дайте сайту разрешение на постоянное хранилище. В браузерах на основе Chromium для этого необходимо поднять приоритет сайта, для этого например можно включить у него уведомления. После чего необходимо обновить страницу и это сообщение исчезнет. ")]):e._e()],1),t("Panel",{attrs:{id:"loading"}},[t("PanelHeader",[e._v("Загрузка")]),t("Div",[t("Spinner")],1),t("Group",[t("Div",[t("Group",{attrs:{title:"Импорт всех диалогов"}},[t("InfoRow",{attrs:{title:e.progress+"%"}},[t("Progress",{attrs:{value:e.progress}})],1)],1),t("br"),t("Group",{attrs:{title:"Импорт всех файлов"}},[t("InfoRow",{attrs:{title:e.progress1+"%"}},[t("Progress",{attrs:{value:e.progress1}})],1)],1),t("br"),t("Group",{attrs:{title:e.progress2text}},[t("InfoRow",{attrs:{title:e.progress2+"%"}},[t("Progress",{attrs:{value:e.progress2}})],1)],1),t("br"),e.memoryUseSupported?t("Group",{attrs:{title:"Использование оперативной памяти"}},[t("InfoRow",{attrs:{title:e.memory+"%"}},[t("Progress",{attrs:{value:e.memory}})],1)],1):e._e(),e.storageQuotaSupported&&"sql"!=e.radioValue?t("Group",{attrs:{title:"Использование постоянной памяти"}},[t("InfoRow",{attrs:{title:e.storage.percent+"%"}},[t("Progress",{attrs:{value:e.storage.percent}})],1)],1):e._e()],1)],1)],1),t("Panel",{attrs:{id:"finalstep"}},[t("PanelHeader",[e._v("БД импортирована")]),t("br"),t("br"),t("br"),"sql"==e.radioValue?t("Div",[t("Button",{on:{click:e.downloadDB}},[e._v("Скачать файл ещё раз")])],1):e._e(),"sql"==e.radioValue?t("Div",[t("Button",{on:{click:e.useRAMDB}},[e._v("Перейти к просмотру")])],1):e._e(),t("Div",[t("Button",{on:{click:e.mainPage}},[e._v("На главную")])],1),0<e.importErrors?t("Div",[e._v(" Не удалось импортировать некоторые сообщения ("+e._s(e.importErrors)+")"),t("br"),e._v(" Причина: "+e._s(e.importErrorMsg)+" ")]):e._e()],1)],1),t("input",{attrs:{type:"file",id:"dirselect",webkitdirectory:"",directory:""},on:{change:e.dirSelected}}),t("input",{attrs:{type:"file",id:"zipselect",accept:".zip"},on:{change:e.zipSelected}})],1)}),[],!1,null,null,null).exports,D=(r("4de4"),r("b0c0"),r("4d63"),r("25f0"),r("841c"),r("9023")),I=r("da06"),j=Object(D.a)("Search"),B=0,A={},F={data:function(e){return{showAfter:!1,focused:!1,placeholderOffset:null,afterWidth:null,textvalue:A[e.$props.cache]||""}},inheritAttrs:!1,computed:{computedPlaceholder:function(){return 0<this.textvalue.length?"":this.placeholder},searchId:function(){return B},classNames:function(){var e=(e={},Object(w.a)(e,"Search--".concat(this.theme),!0),Object(w.a)(e,"Search--focused",this.focused),Object(w.a)(e,"Search--has-value",!!this.value),Object(w.a)(e,"Search--has-after",!!this.$slots.after),e);return Object(I.a)(j,e)}},props:{value:{type:String,dafault:""},placeholder:{type:String,default:"Поиск"},theme:{type:String,required:!1,default:"default",validator:function(e){return 0<=["header","default"].indexOf(e)}},autoComplete:{type:String,default:"off"},cache:{type:String,default:"search"}},created:function(){B++},methods:{enterClicked:function(){A[this.$props.cache]=this.$refs.input.value,this.$emit("input",this.$refs.input.value)},focusHandler:function(){this.focused=!0},blurHandler:function(e){this.focused=!1,this.$emit("blur",e)},cancelHandler:function(){this.$emit("input",""),this.focused=!1}}},M=(t=(r("1c76"),Object(P.a)(F,(function(){var e=this,t=e.$createElement;t=e._self._c||t;return t("div",{class:e.classNames},[t("div",{staticClass:"Search__in"},[t("div",{staticClass:"Search__width"}),t("div",{staticClass:"Search__control"},[t("input",e._b({directives:[{name:"model",rawName:"v-model",value:e.textvalue,expression:"textvalue"}],ref:"input",staticClass:"Search__input",attrs:{id:"search-"+e.searchId,type:"text",autoComplete:e.autoComplete},domProps:{value:e.textvalue},on:{focus:e.focusHandler,blur:e.blurHandler,keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.enterClicked(t)},input:function(t){t.target.composing||(e.textvalue=t.target.value)}}},"input",e.$attrs,!1)),e.$slots.after?t("div",{staticClass:"Search__after-width"}):e._e(),t("label",{staticClass:"Search__placeholder",attrs:{for:"search-"+e.searchId}},[t("div",{staticClass:"Search__placeholder-in"},[t("vkui-icon",{attrs:{name:"search",size:"16"}}),t("div",{staticClass:"Search__placeholder-text",domProps:{innerHTML:e._s(e.computedPlaceholder)}})],1)])]),t("div",{staticClass:"Search__after",on:{click:e.enterClicked}},[t("div",{staticClass:"Search__after-in"},[e._v(" Поиск ")])])])])}),[],!1,null,null,null).exports),r("c740"),r("fb6a"),r("9911"),0),q=(c={data:function(){return{date:""}},props:{source:{type:Object,default:function(){return{id:"",cid:0,uid:0,txt:0,date:0,att:[]}}}},methods:{activateLinks:function(e){return(e=e.replace(/</g,"&lt;").replace(/>/g,"&gt;")).replace(/((https?:\/\/|)[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_+.~#?&//=]*))/gim,'<a target="_blank" href="$1">$1</a>')},getTime:function(e){return new Date(1e3*e).toLocaleTimeString()},getDate:function(e){return e=new Date(1e3*e).toLocaleDateString(),M==e?"":M=e},getAttachmentsHTML:function(e){var t="";if(e.att){var r=Object(i.a)(e.att);try{for(r.s();!(n=r.n()).done;){var n=n.value;"Фотография"===n.desc?t+='<a href="'.concat(n.link,'" target="_blank"><img src="').concat(n.link,'" class="msg-img"></a>'):n.desc.match("прикреп")?t+='<div class="attach forwarded">'.concat(n.desc,"</div>"):n.link?t+='<div><a href="'.concat(n.link,'" target="_blank" class="attach">').concat(n.desc,"</a></div>"):t+='<div class="attach">'.concat(n.desc,"</div>")}}catch(e){r.e(e)}finally{r.f()}}return t}}},Object(P.a)(c,(function(){var e=this,t=e.$createElement;t=e._self._c||t;return t("div",{staticClass:"message",class:{"message-right":0==e.source.uid,"message-plus-date":""!=e.date},attrs:{set:e.date=e.getDate(e.source.date)}},[e.date?t("div",{staticClass:"date"},[e._v(e._s(e.date))]):e._e(),t("span",{domProps:{innerHTML:e._s(e.activateLinks(e.source.txt))}}),t("div",{domProps:{innerHTML:e._s(e.getAttachmentsHTML(e.source))}}),t("div",{staticClass:"bottomtext"},[2e9<=e.source.cid?t("span",{staticClass:"msgauthor"},[e._v(e._s(e.source.uname)+" в")]):e._e(),e._v(" "+e._s(e.getTime(e.source.date))+" ")])])}),[],!1,null,null,null).exports),N=(k=r("89c1"),T=r.n(k),D={props:["messages","chatid"],mounted:function(){var e=this;this.$refs.vsl.scrollToBottom(),setTimeout((function(){e.$refs.vsl.scrollToBottom()}),100),setTimeout((function(){e.dataRequest=!1}),600)},beforeUpdate:function(){var e=this;this.dataRequest&&-1==this.msgLoadDir&&(this.sids=this.messages.slice(0,this.messages.findIndex((function(t){return t.id==e.firstMid}))).map((function(e){return e.id})),this.$nextTick(this.fixPosition))},updated:function(){this.msgLoadDir&&(this.dataRequest=!1)},components:{VirtualList:T.a},methods:{loadMore:function(e){var t;this.dataRequest||(this.dataRequest=!0,this.msgLoadDir=e,this.firstMid=this.messages[0].id,t=this.messages[this.messages.length-1].id,this.$emit("prevmsg",{dir:e,mid:e<0?this.firstMid:t}))},fixPosition:function(){var e=this,t=this.sids;0!=t.length&&(t=t.reduce((function(t,r){return t+e.$refs.vsl.getSize(r)}),0),this.$refs.vsl.scrollToOffset(t))}},data:function(){return{dataRequest:!0,msgLoadDir:0,sids:[],firstMid:0,messageComponent:q}}},F=(r("e3b5"),Object(P.a)(D,(function(){var e=this,t=e.$createElement;t=e._self._c||t;return t("div",{ref:"wrapper",staticClass:"messagelist-wrapper"},[t("virtual-list",{directives:[{name:"show",rawName:"v-show",value:!!e.messages.length,expression:"!!messages.length"}],ref:"vsl",staticClass:"msg-stream scroll-touch",attrs:{"data-key":"id","data-sources":e.messages,"data-component":e.messageComponent,"estimate-size":58,"item-class":"stream-item",keeps:30},on:{totop:function(t){return e.loadMore(-1)},tobottom:function(t){return e.loadMore(1)}}})],1)}),[],!1,null,null,null).exports),c={mounted:function(){this.scrollTarget=document.body.parentElement,window.addEventListener("scroll",this.scrollHandler)},unmounted:function(){window.removeEventListener("scroll",this.scrollHandler)},beforeUpdate:function(){this.dataRequest=!1},data:function(){return{dataRequest:!1,scrollTarget:!1}},props:["data"],methods:{getShortText:function(e){var t=e.toLowerCase(),r=this.data.query.toLowerCase();r=t.indexOf(r);return e.slice(40<r?e.indexOf(" ",r-40):0,r+200)},scrollHandler:function(){this.scrollTarget.scrollTop>this.scrollTarget.scrollHeight-document.body.offsetHeight-200&&!this.dataRequest&&(this.dataRequest=!0,this.$emit("more"))},getDate:function(e){return new Date(1e3*e).toLocaleDateString()},loadDialog:function(e,t){this.$emit("chat",{cid:e,mid:t})}}},k=(r("93f0"),Object(P.a)(c,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"reswrapper",staticClass:"wrapper"},[r("Group",[r("List",e._l(e.data.results,(function(t,n){return r("Cell",{key:n,on:{click:function(r){return e.loadDialog(t.cid,t.id)}}},[e._v(" "+e._s(e.getShortText(t.txt))+" "),r("div",{staticClass:"search-meta"},[e._v(e._s(t.uname)+" "),t.uid==t.cid?r("span",[e._v("в личном сообщении ")]):r("span",[e._v("в диалоге "+e._s(t.cname)+" ")]),e._v("в "+e._s(e.getDate(t.date)))])])})),1)],1)],1)}),[],!1,null,"d5f2b6d4",null).exports),D=r("ec45"),c=(r("411c"),{props:{source:{type:Object,default:function(){return{id:0,name:""}}},dialogOpener:{type:Function}}}),Object(P.a)(c,(function(){var e=this,t=e.$createElement;return(e._self._c||t)("Cell",{on:{click:function(t){return e.dialogOpener(e.source.id,e.source.name)}}},[e._v(" "+e._s(e.source.name)+" ")])}),[],!1,null,null,null).exports),$=(T={name:"ViewerApp",provide:{webviewType:"internal"},components:{BetterSearch:t,MessageList:F,DatePicker:D.a,SearchResults:k,VirtualList:T.a},computed:{filteredChats:function(){var e,t=this,r=this.chats.filter((function(e){return E.idFilter[t.idFilter](e)}));return this.chatNameFilter&&(e=new RegExp(this.chatNameFilter,"i"),r=r.filter((function(t){return t.name.match(e)}))),r}},methods:{fileSelected:function(){var e=this,t=window.sqlDBselector.files[0],r=new FileReader;this.dbError="Загрузка...",r.onload=function(){var t=new Uint8Array(r.result);e.dbProvider=new e.dbAdapters.sql(!1,t),e.dbProvider.dbReady.then((function(){e.dbError=!1,e.loadChatList()})),e.closeDBSelector()},r.readAsArrayBuffer(t)},selectDataSource:function(e){var t=this,r=1<arguments.length&&void 0!==arguments[1]&&arguments[1];this.dbProvider=new this.dbAdapters[e](!1),this.dbProvider.check().then((function(e){t.dbError=!e&&"Не удалось найти данные в выбранной БД.",r&&!e&&(t.dbError="",t.dbSelectorOpened=!0),e&&(t.closeDBSelector(),t.loadChatList())}))},closeDBSelector:function(){this.dbSelectorOpened=!1},closeFilterSelector:function(){this.filterOpened=!1},closeSearchBox:function(){this.searchOpened=!1},goBack:function(){history.back()},mainPage:function(){this.$emit("gohome"),window.location.replace("#")},loadChatList:function(){var e=this;this.dbProvider.getChats().then((function(t){e.chats=t,e.chats.map((function(t){e.chatsById[t.id]=t.name})),e.loadUserList()}))},loadUserList:function(){var e=this;this.dbProvider.getUsers().then((function(t){t.map((function(t){e.usersById[t.id]=t.name}))}))},applyNameFilter:function(e){this.chatNameFilter=e,this.closeFilterSelector()},addUsername:function(e){for(var t=0,r=e.length;t<r;t++)e[t].uname=this.usersById[e[t].uid]||"";return e},addChatname:function(e){for(var t=0,r=e.length;t<r;t++)e[t].cname=this.chatsById[e[t].cid]||"";return e},openDialog:function(e,t){var r=this;this.resetSelectedChat(t,e),history.pushState({},"Просмотр сообщений","#viewer/messages"),this.selectedChat.bottomLimitReached=!0,this.dbProvider.getMessages({cid:{"=":e},_limit:30,_order:"id",_order_type:"DESC"}).then((function(e){r.addUsername(e),r.msgsInSelectedChat=e.reverse()}))},loadMoreMessages:function(e){var t=this,r=e.dir;e=e.mid,e=0<r?{">":e}:{"<":e};-1==r&&this.selectedChat.topLimitReached||1==r&&this.selectedChat.bottomLimitReached?this.$refs.msglist.dataRequest=!1:(e={cid:{"=":this.selectedChat.id},id:e,_limit:30,_order:"id",_order_type:-1==r?"DESC":"ASC"},this.dbProvider.getMessages(e).then((function(e){0==e.length&&(t.limitReached(r),t.$refs.msglist.dataRequest=!1),t.addUsername(e),t.msgsInSelectedChat=r<0?[].concat(Object(s.a)(e.reverse()),Object(s.a)(t.msgsInSelectedChat)):[].concat(Object(s.a)(t.msgsInSelectedChat),Object(s.a)(e))})).catch((function(){t.limitReached(r),t.$refs.msglist.dataRequest=!1})))},limitReached:function(e){-1==e?this.selectedChat.topLimitReached=!0:this.selectedChat.bottomLimitReached=!0},openDialogFromSearch:function(e){var t=e.cid;e=e.mid;history.pushState({},"Просмотр сообщений","#viewer/messages"),this.resetSelectedChat(this.chats.find((function(e){return e.id==t})).name,t),this.loadMoreMessages({dir:-1,mid:e+5})},dateSelected:function(e){var t=new Date(e.setHours(0));e=new Date(e.setDate(e.getDate()+1));this.showDatePicker=!1,this.dateSearch(~~(t.getTime()/1e3),~~(e.getTime()/1e3))},resetSelectedChat:function(e,t){this.selectedChat.name=e,this.selectedChat.id=t,this.panel="dialogview",this.selectedChat.topLimitReached=!1,this.selectedChat.bottomLimitReached=!1,this.msgsInSelectedChat=[]},dateSearch:function(e,t){var r=this;history.pushState({},"Поиск по дате","#viewer/searchbydate"),this.panel="searchresults",this.dbProvider.getMessages({date:{"<":t,">":e},_order:"id",_order_type:"DESC"}).then((function(e){r.search.results=e})).catch((function(){}))},runSearch:function(e,t){var r=this;this.dbProvider.getMessages({txt:{LIKE:"'%".concat(e.replace(/%|'/g,""),"%'")},_limit:30,_offset:t,_order:"id",_order_type:"DESC"}).then((function(e){r.search.results=[].concat(Object(s.a)(r.search.results),Object(s.a)(e)),r.search.offset+=30})).catch((function(){r.search.offset}))},findMessages:function(e){""!=e&&(history.pushState({},"Поиск сообщений","#viewer/search"),this.panel="searchresults",this.search.results=[],this.search.query=e,this.search.offset=0,this.runSearch(e,0))},loadMoreSearchResults:function(){this.runSearch(this.search.query,this.search.offset)}},watch:{"search.results":function(){this.addUsername(this.search.results),this.addChatname(this.search.results)}},created:function(){var e=this;this.$root.$off("back"),this.$root.$on("back",(function(){switch(e.panel){case"dialoglist":e.filterOpened||e.searchOpened||e.dbSelectorOpened?(e.filterOpened=!1,e.searchOpened=!1,e.dbSelectorOpened=!1):e.mainPage();break;case"searchresults":e.panel="dialoglist";break;case"dialogview":e.panel=e.searchOpened?"searchresults":"dialoglist"}}))},mounted:function(){this.dbChoice&&"sql"!=this.dbChoice?this.selectDataSource(this.dbChoice,!0):this.$root.db?(this.dbProvider=this.$root.db,this.loadChatList()):this.dbSelectorOpened=!0},data:function(){return{chats:[],chatsById:{},usersById:{},selectedChat:{id:0,name:"",topLimitReached:!1,bottomLimitReached:!1},search:{query:"",offset:0,results:[]},msgsInSelectedChat:[],showDatePicker:!1,dbChoice:localStorage["vkmsg-db-sel"],dbAdapters:{idb:C,wql:R,sql:x},dbSelectorOpened:!1,filterOpened:!1,searchOpened:!1,dbError:!1,dbProvider:!1,idFilter:"all",chatNameFilter:"",panel:"dialoglist",dialogListItemComponent:N}}},L=(r("0661"),{data:function(){return{viewSelected:0}},components:{App:L,ViewerApp:Object(P.a)(T,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("VKView",{attrs:{activePanel:e.panel}},[r("Panel",{attrs:{id:"dialoglist"}},[r("PanelHeader",{scopedSlots:e._u([{key:"left",fn:function(){return[r("HeaderButton",{on:{click:e.mainPage}},[r("vkui-icon",{attrs:{name:"home"}})],1),r("HeaderButton",{on:{click:function(t){e.dbSelectorOpened=!e.dbSelectorOpened}}},[r("vkui-icon",{attrs:{name:"upload"}})],1)]},proxy:!0},{key:"right",fn:function(){return[e.searchOpened?r("HeaderButton",{on:{click:function(t){e.showDatePicker=!e.showDatePicker}}},[r("date-picker",{attrs:{type:"date",open:e.showDatePicker},on:{input:e.dateSelected}}),r("vkui-icon",{attrs:{name:"newsfeed"}})],1):e._e(),r("HeaderButton",{on:{click:function(t){e.filterOpened=!e.filterOpened}}},[r("vkui-icon",{attrs:{name:"filter"}})],1),r("HeaderButton",{on:{click:function(t){e.searchOpened=!e.searchOpened}}},[r("vkui-icon",{attrs:{name:"search"}})],1)]},proxy:!0}])},[e._v(" Диалоги ")]),r("HeaderContext",{attrs:{opened:e.dbSelectorOpened,onClose:e.closeDBSelector}},[r("List",[r("Cell",{on:{click:function(t){return e.selectDataSource("idb")}}},[e._v("Использовать IndexedDB")]),r("Cell",{on:{click:function(t){return e.selectDataSource("wql")}}},[e._v("Использовать WebSQL")]),r("label",{attrs:{for:"sqlDBselector"}},[r("Cell",[e._v("Загрузить из файла SQLite")])],1),e.dbError?r("CellButton",{attrs:{level:"danger",id:"dbError"}},[e._v(e._s(e.dbError))]):e._e(),r("input",{attrs:{type:"file",id:"sqlDBselector"},on:{change:e.fileSelected}})],1)],1),r("HeaderContext",{attrs:{opened:e.filterOpened,onClose:e.closeFilterSelector}},[r("Tabs",[r("TabsItem",{attrs:{selected:"all"==e.idFilter},on:{click:function(t){e.idFilter="all"}}},[e._v("Все")]),r("TabsItem",{attrs:{selected:"users"==e.idFilter},on:{click:function(t){e.idFilter="users"}}},[e._v("Люди")]),r("TabsItem",{attrs:{selected:"groups"==e.idFilter},on:{click:function(t){e.idFilter="groups"}}},[e._v("Группы")]),r("TabsItem",{attrs:{selected:"chats"==e.idFilter},on:{click:function(t){e.idFilter="chats"}}},[e._v("Беседы")])],1),r("BetterSearch",{attrs:{placeholder:"Поиск диалогов",cache:"dialogSearch"},on:{input:e.applyNameFilter}})],1),r("HeaderContext",{attrs:{opened:e.searchOpened,onClose:e.closeSearchBox}},[r("BetterSearch",{attrs:{placeholder:"Поиск сообщений",cache:"messageSearch"},on:{input:e.findMessages}})],1),0<e.filteredChats.length?r("Group",{class:{blurred:e.searchOpened||e.filterOpened}},[r("List",[r("VirtualList",{attrs:{"data-sources":e.filteredChats,"data-key":"id","data-component":e.dialogListItemComponent,"estimate-size":44,keeps:40,"extra-props":{dialogOpener:e.openDialog},"page-mode":!0,"item-class":"Cell Cell--ios"}})],1)],1):r("div",[0<e.chats.length?r("Div",[e._v("Нет результатов")]):r("div",[e.dbProvider?r("Div",[r("ScreenSpinner")],1):r("Div",[e._v("Выберете источник данных")])],1)],1)],1),r("Panel",{attrs:{id:"searchresults"}},[r("PanelHeader",{scopedSlots:e._u([{key:"left",fn:function(){return[r("HeaderButton",{on:{click:function(t){return e.goBack()}}},[r("vkui-icon",{attrs:{name:"back"}})],1)]},proxy:!0}])},[e._v(" Результаты поиска ")]),0==e.search.results.length?r("Div",[e._v("Нет результатов")]):r("SearchResults",{attrs:{data:e.search},on:{more:e.loadMoreSearchResults,chat:e.openDialogFromSearch}})],1),r("Panel",{attrs:{id:"dialogview"}},[r("PanelHeader",{scopedSlots:e._u([{key:"left",fn:function(){return[r("HeaderButton",{on:{click:function(t){return e.goBack()}}},[r("vkui-icon",{attrs:{name:"back"}})],1)]},proxy:!0}])},[e._v(" "+e._s(e.selectedChat.name)+" ")]),r("MessageList",{ref:"msglist",attrs:{messages:e.msgsInSelectedChat,chatid:e.selectedChat.id},on:{prevmsg:e.loadMoreMessages}})],1)],1)}),[],!1,null,null,null).exports},mounted:function(){1<window.location.hash.length&&window.location.replace("#")},methods:{selectView:function(e){1==e?history.pushState({},"Импорт сообщений","#import"):history.pushState({},"Просмотрщик сообщений","#viewer"),this.viewSelected=e}}}),r("fde4"),r("3f2d"),Object(P.a)(L,(function(){var e=this,t=e.$createElement;t=e._self._c||t;return t("div",{attrs:{id:"app"}},[0==e.viewSelected?t("VKView",{attrs:{activePanel:"menu"}},[t("Panel",{attrs:{id:"menu"}},[t("PanelHeader",[e._v("Добро пожаловать")]),t("br"),t("Group",{attrs:{id:"homescreen-block"}},[t("Div",[e._v(" Это приложение позволяет осуществлять быстрый поиск по сообщеням, выгруженным с помощью экспорта данных из ВКонтакте. При первом запуске необходимо выбрать папку с сообщениями, импортировать и проиндексировать их. Все данные будут храниться локально. Отключите интернет на устройстве, чтобы в этом убедиться. Исходный код данного проекта открыт и доступен "),t("a",{attrs:{href:"https://github.com/remixer-dec/vk-export-msg-searcher",target:"_blank"}},[e._v("тут")]),e._v(". ")]),t("Div",[t("Button",{on:{click:function(t){return e.selectView(1)}}},[e._v("Импортировать сообщения")])],1),t("Div",[t("Button",{on:{click:function(t){return e.selectView(2)}}},[e._v("Перейти к просмотру")])],1)],1)],1)],1):e._e(),1==e.viewSelected?t("App",{on:{gohome:function(t){e.viewSelected=0}}}):e._e(),2==e.viewSelected?t("ViewerApp",{on:{gohome:function(t){e.viewSelected=0}}}):e._e()],1)}),[],!1,null,"88b87e0c",null).exports);T=r("e9dc"),P=r("4947"),r("1bc1"),L=r("5cd9"),L=r.n(L);a.default.config.productionTip=!1,a.default.use(L.a);var H=new a.default({components:Object(n.a)(Object(n.a)({},T.a),P.a),render:function(e){return e($)}}).$mount("#app");window.onhashchange=function(){H.$emit("back")}},"59fc":function(e,t,r){},6:function(e,t){},7:function(e,t){},"85ec":function(e,t,r){},"93f0":function(e,t,r){"use strict";r("4f9f")},9559:function(e,t,r){},b218:function(e,t,r){},e3b5:function(e,t,r){"use strict";r("59fc")},ef9e:function(e,t,r){},f535:function(e,t,r){},fde4:function(e,t,r){"use strict";r("b218")}});